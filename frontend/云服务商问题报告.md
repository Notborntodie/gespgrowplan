# 云服务商 HTTPS 连接问题报告

## 问题描述

域名 `zhengyanchen.cn` 的 HTTPS 访问在 TLS 握手阶段被重置，错误信息：
```
Connection reset by peer
curl: (35) Recv failure: Connection reset by peer
```

## 服务器信息

- **服务器 IP**: 106.14.143.27
- **域名**: zhengyanchen.cn
- **端口**: 443 (HTTPS)
- **SSL 证书**: Let's Encrypt (有效期至 2026-04-04)

## 测试结果

### ✅ 正常的部分

1. **DNS 解析**: 正常，多个 DNS 服务器都正确解析到 106.14.143.27
2. **TCP 连接**: 成功（`nc -zv zhengyanchen.cn 443` 成功）
3. **服务器本地 HTTPS**: 正常（返回 HTTP 200）
4. **使用 IP + Host 头访问**: 成功（`curl -H "Host: zhengyanchen.cn" https://106.14.143.27/` 成功）
5. **OpenSSL SSL 握手**: 成功（证书验证通过）

### ❌ 失败的部分

1. **使用域名访问 HTTPS**: 失败（TLS 握手阶段被重置）
   ```bash
   $ curl -v https://zhengyanchen.cn/
   * Connected to zhengyanchen.cn (106.14.143.27) port 443
   * (304) (OUT), TLS handshake, Client hello (1):
   * Recv failure: Connection reset by peer
   ```

## 服务器端配置

- **Nginx**: 正常运行，配置正确
- **443 端口**: 正常监听
- **SSL 证书**: 存在且有效
- **防火墙**: firewalld 已开放 443 端口
- **Nginx 错误日志**: 无 SSL/TLS 相关错误

## 问题分析

根据测试结果，问题不在服务器端配置，而是在**网络层面**：

1. **TCP 连接成功** → 说明端口是开放的
2. **服务器本地连接正常** → 说明 Nginx 配置正确
3. **使用 IP + Host 头访问成功** → 说明服务器端完全正常
4. **使用域名访问失败** → 说明问题在网络中间层

**结论**: 很可能是云服务商的安全策略、WAF、DDoS 防护或负载均衡器在 TLS 握手阶段拦截了使用域名访问的请求。

## 需要检查的配置

请检查以下云服务商控制台的配置：

1. **安全组规则**
   - 入站规则：确保 443 端口对 0.0.0.0/0 开放
   - 出站规则：确保正常

2. **WAF (Web Application Firewall)**
   - 是否启用了 WAF
   - 是否有域名白名单/黑名单
   - 是否有 TLS/SSL 相关的拦截规则

3. **DDoS 防护**
   - 是否启用了 DDoS 防护
   - 是否有针对域名的防护策略
   - 是否有 TLS 握手频率限制

4. **负载均衡器**（如果使用）
   - HTTPS 监听器配置
   - 域名绑定配置
   - 健康检查配置

5. **安全策略**
   - 是否有域名白名单/黑名单
   - 是否有 TLS 客户端特征检查
   - 是否有 SNI (Server Name Indication) 检查

## 测试命令

如果需要进一步测试，可以使用以下命令：

```bash
# 测试 DNS 解析
dig zhengyanchen.cn +short

# 测试 TCP 连接
nc -zv zhengyanchen.cn 443

# 测试 HTTPS（域名，失败）
curl -v https://zhengyanchen.cn/

# 测试 HTTPS（IP + Host，成功）
curl -v -H "Host: zhengyanchen.cn" https://106.14.143.27/

# 测试 SSL 握手
openssl s_client -connect zhengyanchen.cn:443 -servername zhengyanchen.cn
```

## 请求协助

请协助检查：
1. 是否有针对 `zhengyanchen.cn` 域名的安全策略或拦截规则？
2. WAF/DDoS 防护是否在 TLS 握手阶段拦截了请求？
3. 是否有负载均衡器配置影响了域名访问？
4. 安全组规则是否完全开放了 443 端口？

## 联系信息

- **问题发生时间**: 2026-01-04
- **问题持续状态**: 持续中
- **影响范围**: 所有使用域名访问 HTTPS 的客户端


