# 数据库 ER 图设计

## OJ（在线判题）实体类

### OJ Problems（OJ题目）

- id: int (主键, 自增)
- title: varchar(200) (非空)
- description: text (非空)
- input_format: text (可空)
- output_format: text (可空)
- data_range: text (可空)
- time_limit: int (默认1000, 毫秒)
- memory_limit: int (默认256, MB)
- level: int (非空, GESP级别1-6)
- publish_date: date (可空)
- total_submissions: int (默认0)
- accepted_submissions: int (默认0)
- created_at: timestamp (默认当前时间)
- updated_at: timestamp (默认当前时间, 更新时自动更新)

### OJ Samples（OJ测试样例）

- id: int (主键, 自增)
- problem_id: int (外键, 非空, 关联OJ Problems.id)
- input: text (非空)
- output: text (非空)
- explanation: text (可空, 样例说明)
- is_hidden: boolean (默认FALSE, true=提交后不显示详细信息, false=提交后可显示)
- is_displayed: boolean (默认TRUE, true=查看题目时展示, false=查看题目时不展示)
- sort_order: int (默认0)
- created_at: timestamp (默认当前时间)

## 核心实体类

### Users（用户）

- id: int (主键, 自增)
- username: varchar(50) (唯一, 非空)
- password: varchar(255) (非空)
- phone: varchar(20) (可空)
- email: varchar(100) (可空)
- real_name: varchar(100) (可空)
- created_at: timestamp (默认当前时间)
- updated_at: timestamp (默认当前时间, 更新时自动更新)

### Exams（考试）

- id: int (主键, 自增)
- name: varchar(100) (非空)
- level: int (非空)
- description: text (可空)
- total_questions: int (非空)
- type: enum('真题','模拟','专项') (非空, 默认'真题')
- created_at: timestamp (默认当前时间)

### Questions（题目）

- id: int (主键, 自增)
- question_text: text (非空)
- question_type: enum('text','code') (可空, 默认'text')
- question_code: text (可空)
- correct_answer: varchar(10) (非空)
- explanation: text (可空)
- level: int (非空, 默认1)
- difficulty: enum('easy','medium','hard') (可空, 默认'medium')
- image_url: varchar(500) (可空)
- question_date: varchar(7) (可空)
- created_at: timestamp (默认当前时间)
- updated_at: timestamp (默认当前时间, 更新时自动更新)

### Options（选项）

- id: int (主键, 自增)
- question_id: int (外键, 非空, [关联Questions.id](http://xn--questions-4f3ol932b.id/))
- option_label: varchar(10) (非空)
- option_value: varchar(10) (非空)
- option_text: text (非空)
- created_at: timestamp (默认当前时间)

### Submissions（答题记录）

- id: int (主键, 自增)
- user_id: int (外键, 非空, [关联Users.id](http://xn--users-sr5hh41z.id/))
- exam_id: int (外键, 非空, [关联Exams.id](http://xn--exams-sr5hh41z.id/))
- attempt_number: int (非空)
- score: int (非空)
- submit_time: timestamp (默认当前时间)

### SubmissionAnswers（答题详情）

- id: int (主键, 自增)
- submission_id: int (外键, 非空, [关联Submissions.id](http://xn--submissions-b96rn989b.id/))
- question_id: int (外键, 非空, [关联Questions.id](http://xn--questions-4f3ol932b.id/))
- user_answer: varchar(10) (非空)
- is_correct: tinyint(1) (非空)
- created_at: timestamp (默认当前时间)

## 知识点相关实体类

### KnowledgePoints（知识点）

- id: int (主键, 自增)
- name: varchar(100) (非空)
- description: text (可空)
- category: varchar(50) (非空)
- level: int (非空, 默认1)
- created_at: timestamp (默认当前时间)
- updated_at: timestamp (默认当前时间, 更新时自动更新)

### QuestionKnowledgePoints（题目知识点关联）

- id: int (主键, 自增)
- question_id: int (外键, 非空, [关联Questions.id](http://xn--questions-4f3ol932b.id/))
- knowledge_point_id: int (外键, 非空, [关联KnowledgePoints.id](http://xn--knowledgepoints-nx4yc349c.id/))
- created_at: timestamp (默认当前时间)

### QuestionUploads（题目上传记录）

- id: int (主键, 自增)
- user_id: int (外键, 非空, [关联Users.id](http://xn--users-sr5hh41z.id/))
- question_id: int (外键, 非空, [关联Questions.id](http://xn--questions-4f3ol932b.id/))
- upload_type: enum('manual','batch','import') (可空, 默认'manual')
- upload_status: enum('pending','approved','rejected') (可空, 默认'pending')
- review_notes: text (可空)
- created_at: timestamp (默认当前时间)
- updated_at: timestamp (默认当前时间, 更新时自动更新)

### QuestionImages（题目图片）

- id: int (主键, 自增)
- question_id: int (外键, 非空, [关联Questions.id](http://xn--questions-4f3ol932b.id/))
- image_url: varchar(500) (非空)
- image_type: enum('question','explanation','hint') (可空, 默认'question')
- display_order: int (可空, 默认0)
- created_at: timestamp (默认当前时间)

## 权限管理实体类

### Roles（角色）

- id: int (主键, 自增)
- name: varchar(50) (唯一, 非空)
- display_name: varchar(100) (非空)
- description: text (可空)
- is_system: tinyint(1) (可空, 默认0)
- created_at: timestamp (默认当前时间)
- updated_at: timestamp (默认当前时间, 更新时自动更新)

### Permissions（权限）

- id: int (主键, 自增)
- name: varchar(100) (唯一, 非空)
- display_name: varchar(100) (非空)
- description: text (可空)
- resource: varchar(50) (非空)
- action: varchar(50) (非空)
- created_at: timestamp (默认当前时间)
- updated_at: timestamp (默认当前时间, 更新时自动更新)

### UserRoles（用户角色关联）

- id: int (主键, 自增)
- user_id: int (外键, 非空, [关联Users.id](http://xn--users-sr5hh41z.id/))
- role_id: int (外键, 非空, [关联Roles.id](http://xn--roles-sr5hh41z.id/))
- assigned_by: int (外键, 可空, [关联Users.id](http://xn--users-sr5hh41z.id/))
- created_at: timestamp (默认当前时间)

### RolePermissions（角色权限关联）

- id: int (主键, 自增)
- role_id: int (外键, 非空, [关联Roles.id](http://xn--roles-sr5hh41z.id/))
- permission_id: int (外键, 非空, [关联Permissions.id](http://xn--permissions-b96rn989b.id/))
- created_at: timestamp (默认当前时间)

### TeacherStudents（师生关系）

- id: int (主键, 自增)
- teacher_id: int (外键, 非空, [关联Users.id](http://xn--users-sr5hh41z.id/))
- student_id: int (外键, 非空, [关联Users.id](http://xn--users-sr5hh41z.id/))
- created_at: timestamp (默认当前时间)
- updated_at: timestamp (默认当前时间, 更新时自动更新)

## 学习计划系统实体类

### LearningPlans（学习计划）

- id: int (主键, 自增)
- name: varchar(255) (非空) 计划名称
- description: text (可空) 计划描述
- level: int (非空) GESP级别(1-4)
- start_time: datetime (非空) 开始时间
- end_time: datetime (非空) 结束时间
- created_at: datetime (默认当前时间)
- updated_at: datetime (默认当前时间, 更新时自动更新)
- created_by: int (可空) 创建者ID
- is_active: boolean (默认TRUE) 是否启用

### LearningTasks（学习任务）

- id: int (主键, 自增)
- plan_id: int (外键, 非空, 关联LearningPlans.id) 所属计划ID
- name: varchar(255) (非空) 任务名称
- description: text (可空) 任务描述
- review_content: text (可空) 复习内容（文本）
- review_video_url: varchar(500) (可空) 复习视频链接
- start_time: datetime (非空) 开始时间
- end_time: datetime (非空) 结束时间
- task_order: int (默认0) 任务顺序
- created_at: datetime (默认当前时间)
- updated_at: datetime (默认当前时间, 更新时自动更新)

### TaskExams（任务-客观题关联）

- id: int (主键, 自增)
- task_id: int (外键, 非空, 关联LearningTasks.id) 任务ID
- exam_id: int (外键, 非空, 关联Exams.id) 考试ID
- exam_order: int (默认0) 练习顺序
- created_at: datetime (默认当前时间)

### TaskOjProblems（任务-OJ题关联）

- id: int (主键, 自增)
- task_id: int (外键, 非空, 关联LearningTasks.id) 任务ID
- problem_id: int (外键, 非空, 关联OJ Problems.id) OJ题目ID
- problem_order: int (默认0) 题目顺序
- created_at: datetime (默认当前时间)

### UserLearningPlans（用户加入的计划）

- id: int (主键, 自增)
- user_id: int (外键, 非空, 关联Users.id) 用户ID
- plan_id: int (外键, 非空, 关联LearningPlans.id) 计划ID
- joined_at: datetime (默认当前时间) 加入时间
- status: varchar(50) (默认'active') 状态: active/completed/cancelled

### UserTaskProgress（用户任务完成进度）

- id: int (主键, 自增)
- user_id: int (外键, 非空, 关联Users.id) 用户ID
- task_id: int (外键, 非空, 关联LearningTasks.id) 任务ID
- is_completed: boolean (默认FALSE) 是否完成
- completed_at: datetime (可空) 完成时间
- created_at: datetime (默认当前时间)
- updated_at: datetime (默认当前时间, 更新时自动更新)

### UserExamProgress（用户客观题练习进度）

- id: int (主键, 自增)
- user_id: int (外键, 非空, 关联Users.id) 用户ID
- exam_id: int (外键, 非空, 关联Exams.id) 客观题ID
- task_id: int (外键, 可空, 关联LearningTasks.id) 任务ID（NULL表示非任务内完成）
- is_completed: boolean (默认FALSE) 是否完成
- best_score: int (默认0) 最高分数
- attempt_count: int (默认0) 尝试次数
- completed_at: datetime (可空) 完成时间
- created_at: datetime (默认当前时间)
- updated_at: datetime (默认当前时间, 更新时自动更新)
- UNIQUE KEY unique_user_exam_task (user_id, exam_id, task_id) 唯一约束

### UserOjProgress（用户OJ题目练习进度）

- id: int (主键, 自增)
- user_id: int (外键, 非空, 关联Users.id) 用户ID
- problem_id: int (外键, 非空, 关联OjProblems.id) OJ题目ID
- task_id: int (外键, 可空, 关联LearningTasks.id) 任务ID（NULL表示非任务内完成）
- is_completed: boolean (默认FALSE) 是否完成
- best_verdict: varchar(50) (可空) 最佳判题结果
- attempt_count: int (默认0) 尝试次数
- completed_at: datetime (可空) 完成时间
- created_at: datetime (默认当前时间)
- updated_at: datetime (默认当前时间, 更新时自动更新)
- UNIQUE KEY unique_user_problem_task (user_id, problem_id, task_id) 唯一约束

### UserPlanProgress（用户计划完成进度）

- id: int (主键, 自增)
- user_id: int (外键, 非空, 关联Users.id) 用户ID
- plan_id: int (外键, 非空, 关联LearningPlans.id) 计划ID
- is_completed: boolean (默认FALSE) 是否完成
- completed_tasks: int (默认0) 已完成任务数
- total_tasks: int (默认0) 总任务数
- completed_at: datetime (可空) 完成时间
- created_at: datetime (默认当前时间)
- updated_at: datetime (默认当前时间, 更新时自动更新)
- UNIQUE KEY unique_user_plan (user_id, plan_id) 唯一约束

## 统计分析实体类

### UserWrongQuestions（用户错题）

- id: int (主键, 自增)
- question_id: int (外键, 非空, [关联Questions.id](http://xn--questions-4f3ol932b.id/))
- question_text: text (非空)
- question_type: enum('text','code') (可空, 默认'text')
- question_code: text (可空)
- correct_answer: varchar(10) (非空)
- explanation: text (可空)
- level: int (非空, 默认1)
- difficulty: enum('easy','medium','hard') (可空, 默认'medium')
- image_url: varchar(500) (可空)
- user_answer: varchar(10) (非空)
- is_correct: tinyint(1) (非空)
- answered_at: timestamp (默认当前时间)
- user_id: int (非空, 默认0)
- exam_id: int (非空, 默认0)
- exam_name: varchar(100) (非空)
- exam_level: int (非空)
- username: varchar(50) (非空)
- attempt_number: int (非空)
- exam_score: int (非空)

### SubmissionStats（答题统计）

- id: int (非空, 默认0)
- user_id: int (非空)
- exam_id: int (非空)
- attempt_number: int (非空)
- score: int (非空)
- submit_time: timestamp (默认当前时间)
- exam_name: varchar(100) (非空)
- total_questions: int (非空)
- percentage: decimal(16,2) (可空)

### KnowledgePointStats（知识点统计）

- id: int (非空, 默认0)
- name: varchar(100) (非空)
- category: varchar(50) (非空)
- level: int (非空, 默认1)
- question_count: bigint (非空, 默认0)
- usage_count: bigint (非空, 默认0)
- correct_rate: decimal(10,4) (可空)

### ExamStats（考试统计）

- exam_id: int (非空, 默认0)
- exam_name: varchar(100) (非空)
- exam_level: int (非空)
- total_participants: bigint (非空, 默认0)
- total_submissions: bigint (非空, 默认0)
- average_score: decimal(13,2) (可空)
- best_score: int (可空)
- worst_score: int (可空)
- excellent_count: decimal(23,0) (可空)
- good_count: decimal(23,0) (可空)
- pass_count: decimal(23,0) (可空)
- fail_count: decimal(23,0) (可空)

### UserAnswerStats（用户答题统计）

- user_id: int (非空, 默认0)
- username: varchar(50) (非空)
- level: int (非空, 默认1)
- difficulty: enum('easy','medium','hard') (可空, 默认'medium')
- total_attempts: bigint (非空, 默认0)
- correct_attempts: decimal(25,0) (可空)
- wrong_attempts: decimal(26,0) (可空)
- correct_rate: decimal(31,2) (可空)

### QuestionDifficultyStats（题目难度统计）

- id: int (非空, 默认0)
- question_text: text (非空)
- level: int (非空, 默认1)
- difficulty: enum('easy','medium','hard') (可空, 默认'medium')
- total_attempts: bigint (非空, 默认0)
- correct_attempts: decimal(25,0) (可空)
- wrong_attempts: decimal(26,0) (可空)
- correct_rate: decimal(31,2) (可空)

### KnowledgePointWrongStats（知识点错误统计）

- knowledge_point_id: int (非空, 默认0)
- knowledge_point_name: varchar(100) (非空)
- category: varchar(50) (非空)
- level: int (非空, 默认1)
- total_questions: bigint (非空, 默认0)
- total_attempts: bigint (非空, 默认0)
- correct_attempts: decimal(25,0) (可空)
- wrong_attempts: decimal(26,0) (可空)
- correct_rate: decimal(31,2) (可空)

### PermissionResourceStats（权限资源统计）

- resource: varchar(50) (非空)
- permission_count: bigint (非空, 默认0)
- role_count: bigint (非空, 默认0)
- available_actions: text (可空)

### RolePermissionsSummary（角色权限汇总）

- role_id: int (非空, 默认0)
- role_name: varchar(50) (非空)
- role_display_name: varchar(100) (非空)
- role_description: text (可空)
- is_system: tinyint(1) (可空, 默认0)
- permission_names: text (可空)
- permission_display_names: text (可空)
- permission_count: bigint (非空, 默认0)
- user_count: bigint (非空, 默认0)

### UserPermissions（用户权限）

- id: int (主键, 自增)
- user_id: int (非空, 默认0)
- username: varchar(50) (非空)
- email: varchar(100) (可空)
- user_status: varchar(6) (非空)
- role_id: int (非空, 默认0)
- role_name: varchar(50) (非空)
- role_display_name: varchar(100) (非空)
- permission_id: int (非空, 默认0)
- permission_name: varchar(100) (非空)
- permission_display_name: varchar(100) (非空)
- resource: varchar(50) (非空)
- action: varchar(50) (非空)
- role_assigned_at: timestamp (默认当前时间)
- assigned_by: int (可空)

### UserRolesSummary（用户角色汇总）

- user_id: int (非空, 默认0)
- username: varchar(50) (非空)
- email: varchar(100) (可空)
- status: varchar(6) (非空)
- role_names: text (可空)
- role_display_names: text (可空)
- role_count: bigint (非空, 默认0)
- permission_count: bigint (非空, 默认0)

## 实体关系

### 核心关系

1. Users 1:N Submissions (一个用户可以有多次答题记录)
    1. 
2. Exams 1:N Submissions (一次考试可以有多次答题记录)
    1. 
3. Exams 1:N Questions (一次考试包含多道题目)
    1. 
4. Questions 1:N Options (一道题目有多个选项)
    1. 
5. Submissions 1:N SubmissionAnswers (一次答题记录包含多道题的答案)
    1. 
6. Questions 1:N SubmissionAnswers (一道题目在多次答题中被回答)
    1. 

### 知识点关系

1. KnowledgePoints N:M Questions (通过QuestionKnowledgePoints表实现多对多关系)
    1. 
2. Users 1:N QuestionUploads (一个用户可以上传多道题目)
    1. 
3. Questions 1:N QuestionUploads (一道题目可以有多个上传记录)
    1. 
4. Questions 1:N QuestionImages (一道题目可以有多张图片)
    1. 

### 权限管理关系

1. Users N:M Roles (通过UserRoles表实现多对多关系)
    1. 
2. Roles N:M Permissions (通过RolePermissions表实现多对多关系)
    1. 
3. Users (教师) 1:N TeacherStudents (一个教师可以有多个学生)
    1. 
4. Users (学生) N:1 TeacherStudents (一个学生可以有多个教师)
    1. 

### 统计分析关系

1. Users 1:N UserWrongQuestions (一个用户可以有多道错题)
    1. 
2. Questions 1:N UserWrongQuestions (一道题目可以被多个用户答错)
    1. 
3. Users 1:N SubmissionStats (一个用户可以有多次答题统计)
    1. 
4. Exams 1:N SubmissionStats (一次考试可以有多条答题统计)
    1. 
5. KnowledgePoints 1:N KnowledgePointStats (一个知识点有一条统计记录)
    1. 
6. Exams 1:N ExamStats (一次考试有一条统计记录)
    1. 
7. Users 1:N UserAnswerStats (一个用户有一条答题统计)
    1. 
8. Questions 1:N QuestionDifficultyStats (一道题目有一条难度统计)
    1. 
9. KnowledgePoints 1:N KnowledgePointWrongStats (一个知识点有一条错误统计)
    1. 
10. Permissions N:1 PermissionResourceStats (多个权限对应一个资源统计)
    1. 
11. Roles 1:N RolePermissionsSummary (一个角色有一条权限汇总)
    1. 
12. Users 1:N UserPermissions (一个用户有多条权限记录)
    1. 
13. Roles 1:N UserPermissions (一个角色有多条用户权限记录)
    1. 
14. Permissions 1:N UserPermissions (一个权限有多条用户权限记录)
    1. 
15. Users 1:N UserRolesSummary (一个用户有一条角色汇总)
    1.

### 学习计划关系

1. LearningPlans 1:N LearningTasks (一个学习计划包含多个学习任务)
    1. 
2. LearningTasks N:M Exams (通过TaskExams表实现多对多关系, 一个任务可以包含多个考试)
    1. 
3. LearningTasks N:M OJ Problems (通过TaskOjProblems表实现多对多关系, 一个任务可以包含多个OJ题目)
    1. 
4. Users N:M LearningPlans (通过UserLearningPlans表实现多对多关系, 一个用户可以加入多个学习计划)
    1. 
5. Users 1:N UserTaskProgress (一个用户可以有多个任务完成进度记录)
    1. 
6. LearningTasks 1:N UserTaskProgress (一个任务可以被多个用户完成)
    1.

